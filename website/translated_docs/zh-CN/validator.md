---
id: validator
title: validator
sidebar_label: Validator
---

## 介绍

验证人是Crust网络中验证交易并生成区块的节点，维护着整个Crust网络的安全。在Crust网络的GPoS（Guranteed Proof of Stake）共识中，验证人节点可以获得Staking奖励以及区块生成奖励。

## 验证人的奖励和惩罚

> 目前Crust网络处于预览网Maxwell阶段，下面描述的奖励和惩罚细则均为Maxwell的规则和参数

### 1. 奖励

验证人的奖励分为两个部分：**出块奖励和质押奖励**，总体来讲，验证人（Validator）会获得出块和质押双重奖励；候选人（Candidate）会获得质押奖励。

#### 出块奖励

出块奖励是指参与Crust网络出块和打包交易的验证人（Validator）获得的收益，出块收益与得分相关

![staking_points](assets/gpos/staking_points.jpg)

**Maxwell中，每个Era（6个小时），会产生150 CRU的总出块收益，并且每90天衰减一半**。而其中每个出块验证人每个Era获得的出块奖励为:

```shell
出块收益 = 总出块收益 * 得分比率（个人得分/总得分）
```

验证人每个era会重新进行一轮选举，会从所有候选人和验证人中选出下一个Era的出块验证人，选举的规则为：

```shell
按照质押上限（Stake Limit）的从高到低进行选举
```

#### 质押奖励

质押奖励是指拥有存储量的验证人（Validator）或候选人（Candidate）通过质押CRU获得收益，质押收益与下列几个因素有关：

- 质押上限（Stake Limit）：质押上限决定了你能够质押的CRU上限值，其与你提供的存储量直接相关，在Maxwell里，**1TB的SRD文件对应上限值为1CRU，而有意义文件是SRD上限值的1-5倍**，具体变化的数值与有意义文件的副本数相关，具体参考[DSM指南](DSM.md);
- 有效质押（Effective Stake）：有效质押是**真正产生收益的质押量**，其与你质押上限和别人对你进行担保CRU的量有关，具体下列会举例说明；
- 担保费率（Guarantee fee）：给担保人的分成比例，这个值越大，担保人收益越高
> 如果一个验证人获取到1000 CRU的Staking收益，并且如果他自身投入的质押金额占总质押金额的90%（另外10%为担保人的投入)。如果该验证人设置的担保费为95%, 则最终担保人将一共获取到 1000 * 10% * 95% = 95 个CRU的收益，剩余5CRU归节点所有。

具体来讲，如何进行质押奖励的分配，首先，**在Maxwell中，每个Era（6个小时），会产生600 CRU的总质押收益，并且每90天衰减一半**，而其中每个验证人/候选人每个Era获得的质押奖励为：


```shell
验证人的总质押量 = 自身质押量 + 担保量
```

```shell
验证人有效质押量 = MIN(质押上限，总质押) * (自身质押量 / 验证人总质押量）
```

```shell
担保人有效质押量 = MIN(质押上限，总质押)* / (担保量 / 验证人总质押量)
```

```shell
验证人收益 = 总质押收益 * 验证人的有效质押量 / 全网有效质押量 + 总质押收益 * 担保人有效质押量 / 全网有效质押量 * (1 - 担保费率)
```

下列以一个场景进行举例说明：
假如节点A质押了1000 CRU，并被担保了200 CRU，而其质押上限为1000 CRU，设置的担保费为95%，每轮产生质押收益为600 CRU，假如全网有效质押量为2000，那么可以算出每个Era的收益为：

1. 验证人的有效质押 = 最小值（1000， 1200）*（1000 / 1200） = 1000 * （1000 / 1200） = 833.3 CRU
2. 担保人的有效质押 = 最小值（1000，1200）* （200 / 1200）= 1000 * （200 / 1000） = 166.66 CRU
3. 验证人收益 = 600 * （833.3 / 2000） + 600 * （166.66 / 2000） * 5% = 252.49

### 2. 罚没

只有验证人（出块人），真正打包区块和交易的节点会被罚没，需要注意的是

1. 罚没触发条件

- 每个Session（10分钟）结束时会判断验证人是否掉线，当检测到Validator掉线时，会触发惩罚机制，开始惩罚数额的计算
- 每次产生区块的时候，会对区块的打包人（作者）进行双花检测，如果检测到在同样的块高，试图产生两个不同区块的时候，会对其产生罚没

2. 罚没结果

抵押的CRU会被按照惩罚比率扣除，自身会被移除验证人身份，并且在处于罚没的验证人，在被罚没之前被担保的部分会丢失。

3. 罚没比率

惩罚金额为在一个SlashingSpan中发生的最大的惩罚比例乘以Validator自身有效票数。

```shell
罚没比率 = min((3 * (k - (n / 10 + 1))) / n, 1) * 0.07
```

其中**k是掉线人数，n是整体验证人（出块人）的数目**。10%的掉线不会触发实习的惩罚，最终会线性爬升到最大值7%。当三分之一的Validator掉线时惩罚比例约等于5%。

4. 罚没的实际扣钱时间

罚没不会立即发，发生时间会延迟28个Era(7天)后扣钱。未实际发生的惩罚可以被取消（通过国库进行申请）。

## 如何成为验证人

要成为Crust网络的验证人，您需要准备一定的存储资源、优质的网络并部署节点。
目前可以参与预览网Maxwell，成为验证人，具体请查看[预览网概要](preview-network-maxwell.md)中关于验证人（节点）的描述。
